(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5049:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var s=a(5155),l=a(9137),i=a.n(l),r=a(2115);let o="__DELETED__";class n{put(e,t){return this.data.has(e)&&(this.mutationOrder=this.mutationOrder.filter(t=>t!==e)),this.mutationOrder.push(e),this.data.set(e,t),'Key "'.concat(e,'" set in MemTable.')}get(e){return this.data.get(e)}delete(e){return this.put(e,o)}isFull(){return this.data.size>=this.maxSize}flush(){let e=Array.from(this.data.entries()).sort((e,t)=>e[0].localeCompare(t[0]));return this.data.clear(),this.mutationOrder=[],e}getDataForViz(){return Array.from(this.data.entries()).sort((e,t)=>e[0].localeCompare(t[0]))}constructor(e){this.maxSize=e,this.data=new Map,this.mutationOrder=[]}}let c=()=>"sstable-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,5)),m=(e,t)=>{let a=0,s=e.length-1;for(;a<=s;){let l=Math.floor((a+s)/2);if(e[l][0]===t)return e[l][1];e[l][0]<t?a=l+1:s=l-1}};class d{get(e){return m(this.data,e)}getDataForViz(){return this.data}getKeyRange(){return{minKey:this.minKey,maxKey:this.maxKey}}overlaps(e,t){return!!this.minKey&&!!this.maxKey&&!!e&&!!t&&this.minKey<=t&&this.maxKey>=e}constructor(e,t,a=[]){this.id=e,this.level=t,this.data=a,this.minKey=a.length>0?a[0][0]:null,this.maxKey=a.length>0?a[a.length-1][0]:null}}class h{_addLog(e){this.log.unshift({text:e,time:new Date().toLocaleTimeString()}),this.log.length>100&&this.log.pop()}put(e,t){if(!e)return void this._addLog("Write failed: Key cannot be empty.");if(this.memtable.isFull()&&(this._addLog("MemTable is full, attempting to flush first."),this.flushMemTable()),this.memtable.isFull())return void this._addLog("Write failed: MemTable is still full. Compaction might be needed or L0 is at capacity and cannot be compacted further.");let a=this.memtable.put(e,t);this._addLog(a),this.metrics.logicalWrites++,this.memtable.isFull()&&this.flushMemTable(),this.triggerCompactionIfNeeded()}delete(e){if(!e)return void this._addLog("Delete failed: Key cannot be empty.");if(this.memtable.isFull()&&(this._addLog("MemTable is full, attempting to flush first."),this.flushMemTable()),this.memtable.isFull())return void this._addLog("Delete failed: MemTable is still full. Compaction might be needed.");let t=this.memtable.delete(e);this._addLog(t),this.metrics.logicalWrites++,this.memtable.isFull()&&this.flushMemTable(),this.triggerCompactionIfNeeded()}get(e){if(!e)return this._addLog("Read failed: Key cannot be empty."),{value:void 0,path:[]};let t=[];this._addLog('Searching for key "'.concat(e,'"...')),this.metrics.logicalReads++,t.push({component:"MemTable",id:"memtable",status:"Checking"}),this.metrics.memtableLookupsForRead++;let a=this.memtable.get(e);if(void 0!==a)return a===o?(this._addLog('Key "'.concat(e,'" found in MemTable as TOMBSTONE.')),t[t.length-1].status="Found (Tombstone)",{value:o,path:t}):(this._addLog('Key "'.concat(e,'" found in MemTable. Value: "').concat(a,'".')),t[t.length-1].status="Found",{value:a,path:t});t[t.length-1].status="Not Found";for(let s=0;s<this.levels.length;s++){let l=this.levels[s];for(let i of 0===s?[...l].reverse():l)if(!(s>0)||!i.minKey||!i.maxKey||!(e<i.minKey)&&!(e>i.maxKey)){if(t.push({component:"L".concat(s," SSTable"),id:i.id,status:"Checking"}),this.metrics.sstablesAccessedForRead++,void 0!==(a=i.get(e))){if(a===o)return this._addLog('Key "'.concat(e,'" found in SSTable ').concat(i.id," (L").concat(s,") as TOMBSTONE.")),t[t.length-1].status="Found (Tombstone)",{value:o,path:t};return this._addLog('Key "'.concat(e,'" found in SSTable ').concat(i.id," (L").concat(s,'). Value: "').concat(a,'".')),t[t.length-1].status="Found",{value:a,path:t}}t[t.length-1].status="Not Found"}}return this._addLog('Key "'.concat(e,'" not found in any SSTable.')),{value:void 0,path:t}}flushMemTable(){if(0===this.memtable.data.size)return this._addLog("MemTable is empty, nothing to flush."),!1;this._addLog("Flushing MemTable to L0...");let e=this.memtable.flush(),t=new d(c(),0,e);return this.levels[0].push(t),this._addLog("Flushed MemTable to new SSTable ".concat(t.id," in L0. Contains ").concat(e.length," items.")),this.metrics.itemsWrittenToSSTables+=e.length,!0}triggerCompactionIfNeeded(){this.levels[0].length>this.config.l0MaxSSTables&&this.compact(0);for(let e=0;e<this.config.maxLevels-1;e++){let t=0===e?this.config.l0MaxSSTables:this.config.l0MaxSSTables*Math.pow(this.config.levelMaxSSTablesFactor,e);this.levels[e].length>t&&this.compact(e)}}compact(e){let t;if(e>=this.config.maxLevels-1)return void this._addLog("Cannot compact L".concat(e," as it's the last configured level."));let a=e+1;this._addLog("Attempting compaction from L".concat(e," to L").concat(a,"..."));let s=[];if(0===e){if(this.levels[0].length<=this.config.l0MaxSSTables&&this.levels[0].length>0)t=[...this.levels[0]],this.levels[0]=[];else{if(!(this.levels[0].length>this.config.l0MaxSSTables))return void this._addLog("L0 has ".concat(this.levels[0].length," tables, not exceeding limit of ").concat(this.config.l0MaxSSTables,". No L0 compaction triggered by threshold."));t=[...this.levels[0]],this.levels[0]=[]}for(let e of(this._addLog("Selected ".concat(t.length," SSTables from L0 for compaction.")),t))if(e.minKey&&e.maxKey)for(let t of this.levels[a])t.overlaps(e.minKey,e.maxKey)&&!s.find(e=>e.id===t.id)&&s.push(t)}else{if(0===this.levels[e].length)return void this._addLog("L".concat(e," is empty. No compaction needed."));let l=(t=[this.levels[e].shift()])[0];if(this._addLog("Selected oldest SSTable ".concat(l.id," from L").concat(e,".")),l.minKey&&l.maxKey)for(let e of this.levels[a])e.overlaps(l.minKey,l.maxKey)&&s.push(e)}if(0===t.length)return void this._addLog("No tables selected for compaction from L".concat(e,". Compaction aborted."));this._addLog("Found ".concat(s.length," overlapping SSTables in L").concat(a," to include in merge.")),this.levels[a]=this.levels[a].filter(e=>!s.find(t=>t.id===e.id));let l=[...t,...s];if(0===l.length){this._addLog("No tables to merge in compaction process. Aborting."),e>0?this.levels[e].unshift(...t):this.levels[e].push(...t);return}this._addLog("Merging the following SSTables: ".concat(l.map(e=>"".concat(e.id,"(L").concat(e.level,")")).join(", "),"."));let i=new Map;for(let e of[...l].sort((e,t)=>e.level!==t.level?e.level-t.level:t.id.localeCompare(e.id)))for(let[t,a]of e.getDataForViz())i.has(t)||i.set(t,a);let r=Array.from(i.entries()).filter(t=>{let[a,s]=t;return s!==o||e<this.config.maxLevels-2}).sort((e,t)=>e[0].localeCompare(t[0]));this._addLog("Merged data resulted in ".concat(r.length," unique, live keys.")),this.metrics.itemsWrittenToSSTables+=r.length;for(let e=0;e<r.length;e+=this.config.sstableMaxItems){let t=r.slice(e,e+this.config.sstableMaxItems);if(t.length>0){let e=new d(c(),a,t);this.levels[a].push(e),this._addLog("Created new SSTable ".concat(e.id," in L").concat(a," with ").concat(t.length," items."))}}a>0&&this.levels[a].sort((e,t)=>null===e.minKey&&null===t.minKey?0:null===e.minKey?-1:null===t.minKey?1:e.minKey.localeCompare(t.minKey)),this._addLog("Compaction from L".concat(e," to L").concat(a," complete.")),this.triggerCompactionIfNeeded()}getMetrics(){let e=this.metrics.logicalWrites>0?this.metrics.itemsWrittenToSSTables/this.metrics.logicalWrites:0,t=this.metrics.logicalReads>0?this.metrics.sstablesAccessedForRead/this.metrics.logicalReads:0;return{...this.metrics,writeAmplification:e.toFixed(2),readAmplificationSSTables:t.toFixed(2)}}getState(){return{memtable:this.memtable.getDataForViz(),levels:this.levels.map(e=>e.map(e=>({id:e.id,level:e.level,data:e.getDataForViz(),minKey:e.minKey,maxKey:e.maxKey}))),log:[...this.log],config:{...this.config},metrics:this.getMetrics()}}reset(e){this.config={memtableMaxSize:e.memtableMaxSize||5,l0MaxSSTables:e.l0MaxSSTables||3,levelMaxSSTablesFactor:e.levelMaxSSTablesFactor||4,sstableMaxItems:e.sstableMaxItems||10,maxLevels:e.maxLevels||5},this.memtable=new n(this.config.memtableMaxSize),this.levels=Array(this.config.maxLevels).fill(null).map(()=>[]),this.log=[],this.metrics={logicalWrites:0,itemsWrittenToSSTables:0,logicalReads:0,sstablesAccessedForRead:0,memtableLookupsForRead:0},this._addLog("LSM Tree has been reset with new configuration.")}constructor(e={}){this.config={memtableMaxSize:e.memtableMaxSize||5,l0MaxSSTables:e.l0MaxSSTables||3,levelMaxSSTablesFactor:e.levelMaxSSTablesFactor||4,sstableMaxItems:e.sstableMaxItems||10,maxLevels:e.maxLevels||5},this.memtable=new n(this.config.memtableMaxSize),this.levels=Array(this.config.maxLevels).fill(null).map(()=>[]),this.log=[],this.metrics={logicalWrites:0,itemsWrittenToSSTables:0,logicalReads:0,sstablesAccessedForRead:0,memtableLookupsForRead:0},this._addLog("LSM Tree initialized.")}}var u=a(381),g=a(6474),x=a(3052),b=a(4788);let f=e=>{let{text:t,children:a}=e,[l,i]=(0,r.useState)(!1);return(0,s.jsxs)("div",{className:"relative inline-block",onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[a,l&&(0,s.jsx)("div",{className:"absolute z-50 bottom-full mb-2 left-1/2 transform -translate-x-1/2 px-3 py-2 text-sm font-medium text-white bg-gray-700 rounded-lg shadow-sm whitespace-nowrap",children:t})]})},p=e=>{let{initialConfig:t,onSave:a,onResetDefault:l}=e,[i,o]=(0,r.useState)(t),[n,c]=(0,r.useState)(!1);(0,r.useEffect)(()=>{o(t)},[t]);let m=e=>{let{name:t,value:a}=e.target,s=parseInt(a,10);o(e=>({...e,[t]:s>0?s:1}))};return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("button",{onClick:()=>c(!n),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center transition-colors",children:[(0,s.jsx)(u.A,{size:20,className:"mr-2"}),"Settings",n?(0,s.jsx)(g.A,{size:20,className:"ml-1"}):(0,s.jsx)(x.A,{size:20,className:"ml-1"})]}),n&&(0,s.jsxs)("div",{className:"mt-2 p-4 border border-gray-300 rounded-lg bg-gray-50 shadow-sm",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-3 text-gray-700",children:"LSM Tree Configuration"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{name:"memtableMaxSize",label:"MemTable Max Size",tip:"Max items in MemTable before flush."},{name:"l0MaxSSTables",label:"L0 Max SSTables",tip:"Max SSTables in L0 before compaction to L1."},{name:"levelMaxSSTablesFactor",label:"Level Max SSTables Factor",tip:"Multiplier for max tables in next level (approx). Ln_max = L0_max * factor^(n-1) for L1+"},{name:"sstableMaxItems",label:"SSTable Max Items",tip:"Max items per SSTable created during compaction."},{name:"maxLevels",label:"Max Levels",tip:"Total number of levels (L0 to L(N-1)). Min 2."}].map(e=>(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("label",{htmlFor:e.name,className:"text-sm font-medium text-gray-600 mb-1 flex items-center",children:[e.label,(0,s.jsx)(f,{text:e.tip,children:(0,s.jsx)(b.A,{size:14,className:"ml-1 text-gray-400 cursor-help"})})]}),(0,s.jsx)("input",{type:"number",id:e.name,name:e.name,value:i[e.name],onChange:m,min:"1",className:"p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-700"})]},e.name))}),(0,s.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{a(i),c(!1)},className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors",children:"Save & Apply"}),(0,s.jsx)("button",{onClick:()=>{let e={memtableMaxSize:5,l0MaxSSTables:3,levelMaxSSTablesFactor:4,sstableMaxItems:10,maxLevels:5};o(e),a(e),c(!1)},className:"px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-colors",children:"Reset to Defaults"})]})]})]})};var y=a(4940),v=a(2525),S=a(7924),j=a(1539),N=a(133);let T=e=>{let{onWrite:t,onRead:a,onDelete:l,onCompact:i,onResetTree:o,isCompacting:n}=e,[c,m]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),[u,g]=(0,r.useState)("");return(0,s.jsxs)("div",{className:"p-4 bg-white shadow-md rounded-lg mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-700",children:"Controls"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[(0,s.jsxs)("div",{className:"space-y-3 p-3 border border-gray-200 rounded-md bg-gray-50",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-600",children:"Write / Delete Data"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"key",className:"block text-sm font-medium text-gray-700",children:"Key:"}),(0,s.jsx)("input",{type:"text",id:"key",value:c,onChange:e=>m(e.target.value),placeholder:"Enter key",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-700"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"value",className:"block text-sm font-medium text-gray-700",children:"Value (optional for Delete):"}),(0,s.jsx)("input",{type:"text",id:"value",value:d,onChange:e=>h(e.target.value),placeholder:"Enter value",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-700"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>{c.trim()?(t(c.trim(),d),m(""),h("")):alert("Key cannot be empty for write.")},className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 flex items-center justify-center transition-colors",children:[(0,s.jsx)(y.A,{size:18,className:"mr-2"})," Write"]}),(0,s.jsxs)("button",{onClick:()=>{c.trim()?(l(c.trim()),m(""),h("")):alert("Key cannot be empty for delete.")},className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 flex items-center justify-center transition-colors",children:[(0,s.jsx)(v.A,{size:18,className:"mr-2"})," Delete"]})]})]}),(0,s.jsxs)("div",{className:"space-y-3 p-3 border border-gray-200 rounded-md bg-gray-50",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-600",children:"Read Data"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"readKey",className:"block text-sm font-medium text-gray-700",children:"Key to Read:"}),(0,s.jsx)("input",{type:"text",id:"readKey",value:u,onChange:e=>g(e.target.value),placeholder:"Enter key to read",className:"mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-700"})]}),(0,s.jsxs)("button",{onClick:()=>{u.trim()?a(u.trim()):alert("Key cannot be empty for read.")},className:"w-full px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center justify-center transition-colors",children:[(0,s.jsx)(S.A,{size:18,className:"mr-2"})," Read"]})]})]}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 flex flex-wrap gap-2",children:[" ",(0,s.jsxs)("button",{onClick:()=>i(0),disabled:n,className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 disabled:bg-gray-400 flex items-center justify-center transition-colors",children:[(0,s.jsx)(j.A,{size:18,className:"mr-2"})," Trigger L0 Compaction"]}),(0,s.jsxs)("button",{onClick:o,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 flex items-center justify-center transition-colors",children:[(0,s.jsx)(N.A,{size:18,className:"mr-2"})," Reset Tree"]})]})]})},L=e=>{let{itemKey:t,itemValue:a,highlight:l}=e,[i,n]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=setTimeout(()=>n(!0),10);return()=>clearTimeout(e)},[]);let c=a===o;return(0,s.jsxs)("div",{className:"px-2 py-1 border rounded-md text-xs transition-all duration-500 ease-in-out transform ".concat(i?"opacity-100 scale-100":"opacity-0 scale-90"," ").concat(c?"border-red-400 bg-red-100":"border-gray-300 bg-gray-100"," ").concat(l?"ring-2 ring-blue-500 shadow-lg":""),children:[(0,s.jsxs)("span",{className:"font-semibold text-blue-700 break-all",children:[t,":"]}),(0,s.jsx)("span",{className:"".concat(c?"text-red-700 italic":"text-gray-700"," break-all"),children:c?" (TOMBSTONE)":" ".concat(a)})]})},M=e=>{var t;let{memtableData:a,maxSize:l,readPathItem:i}=e,[o,n]=(0,r.useState)(!0);return(0,s.jsxs)("div",{className:"p-4 border rounded-lg shadow-sm mb-4 transition-all duration-300 ease-in-out ".concat((null==i?void 0:i.status)==="Checking"?"ring-2 ring-yellow-400 animate-pulse":(null==i||null==(t=i.status)?void 0:t.startsWith("Found"))?"ring-2 ring-green-400":"border-blue-300"," bg-blue-50"),children:[(0,s.jsxs)("button",{onClick:()=>n(!o),className:"w-full text-left font-semibold text-blue-700 mb-2 flex items-center",children:[o?(0,s.jsx)(g.A,{size:20,className:"mr-1"}):(0,s.jsx)(x.A,{size:20,className:"mr-1"}),"MemTable (Size: ",a.length," / ",l,")",i&&(0,s.jsx)("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded ".concat("Found"===i.status?"bg-green-200 text-green-800":"Found (Tombstone)"===i.status?"bg-red-200 text-red-800":"Checking"===i.status?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"),children:i.status})]}),o&&(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2",children:[0===a.length&&(0,s.jsx)("p",{className:"text-sm text-gray-500 italic col-span-full",children:"Empty"}),a.map(e=>{let[t,a]=e;return(0,s.jsx)(L,{itemKey:t,itemValue:a},"mem-".concat(t))})]})]})},w=e=>{var t;let{sstable:a,readPathItem:l}=e,[i,o]=(0,r.useState)(!1),[n,c]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=setTimeout(()=>c(!0),10);return()=>clearTimeout(e)},[]),(0,s.jsxs)("div",{className:"p-3 border rounded-lg mb-2 shadow-sm relative transition-all duration-500 ease-in-out transform ".concat(n?"opacity-100 scale-100":"opacity-0 scale-95"," ").concat((null==l?void 0:l.status)==="Checking"?"ring-2 ring-yellow-400 animate-pulse":(null==l||null==(t=l.status)?void 0:t.startsWith("Found"))?"ring-2 ring-green-400":"border-gray-300"," bg-gray-50"),children:[(0,s.jsxs)("button",{onClick:()=>o(!i),className:"w-full text-left text-sm font-medium text-gray-700 mb-1 flex items-center",children:[i?(0,s.jsx)(g.A,{size:18,className:"mr-1"}):(0,s.jsx)(x.A,{size:18,className:"mr-1"}),"SSTable:"," ",(0,s.jsx)("span",{className:"font-mono text-xs ml-1 mr-1 px-1 bg-gray-200 rounded",children:a.id.substring(a.id.length-5)})," ","(",a.data.length," items)",l&&(0,s.jsx)("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded ".concat("Found"===l.status?"bg-green-200 text-green-800":"Found (Tombstone)"===l.status?"bg-red-200 text-red-800":"Checking"===l.status?"bg-yellow-200 text-yellow-800":"bg-gray-200 text-gray-800"),children:l.status})]}),a.minKey&&a.maxKey&&(0,s.jsxs)("div",{className:"text-xs text-gray-500 mb-1 ml-5",children:["Range: [",a.minKey," - ",a.maxKey,"]"]}),i&&(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-1 pl-2",children:[0===a.data.length&&(0,s.jsx)("p",{className:"text-xs text-gray-400 italic col-span-full",children:"Empty"}),a.data.map(e=>{let[t,l]=e;return(0,s.jsx)(L,{itemKey:t,itemValue:l},"".concat(a.id,"-").concat(t))})]})]})},k=e=>{let{level:t,levelIdx:a,readPath:l}=e,[i,o]=(0,r.useState)(!0),n=["bg-purple-100 border-purple-300","bg-indigo-100 border-indigo-300","bg-sky-100 border-sky-300","bg-teal-100 border-teal-300","bg-emerald-100 border-emerald-300","bg-lime-100 border-lime-300","bg-amber-100 border-amber-300"],c=n[a%n.length];return(0,s.jsxs)("div",{className:"p-3 border rounded-lg mb-3 shadow ".concat(c),children:[(0,s.jsxs)("button",{onClick:()=>o(!i),className:"w-full text-left text-md font-semibold text-gray-800 mb-2 flex items-center",children:[i?(0,s.jsx)(g.A,{size:20,className:"mr-1"}):(0,s.jsx)(x.A,{size:20,className:"mr-1"}),"Level ",a," (",t.length," SSTables)"]}),i&&(0===t.length?(0,s.jsx)("p",{className:"text-sm text-gray-500 italic ml-5",children:"Empty"}):(0,s.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,s.jsx)(w,{sstable:e,readPathItem:null==l?void 0:l.find(t=>t.id===e.id)},e.id))}))]})};var z=a(9397);let K=e=>{let{logs:t}=e,[a,l]=(0,r.useState)(!0),i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{a&&i.current&&(i.current.scrollTop=0)},[t,a]),(0,s.jsxs)("div",{className:"bg-gray-800 text-white p-4 rounded-lg shadow-lg",children:[(0,s.jsxs)("button",{onClick:()=>l(!a),className:"w-full text-left font-semibold text-gray-100 mb-2 flex items-center",children:[a?(0,s.jsx)(g.A,{size:20,className:"mr-1"}):(0,s.jsx)(x.A,{size:20,className:"mr-1"}),(0,s.jsx)(z.A,{size:18,className:"mr-2"})," Activity Log"]}),a&&(0,s.jsxs)("div",{ref:i,className:"h-60 overflow-y-auto space-y-1 text-sm font-mono border-t border-gray-700 pt-2",children:[0===t.length&&(0,s.jsx)("p",{className:"text-gray-400 italic",children:"No activities yet."}),t.map((e,t)=>(0,s.jsxs)("div",{className:"whitespace-pre-wrap hover:bg-gray-700 px-1 rounded",children:[(0,s.jsx)("span",{className:"text-gray-400 select-none",children:e.time}),":"," ",(0,s.jsx)("span",{className:"text-gray-200",children:e.text})]},t))]})]})};var F=a(235);let C=e=>{let{metrics:t}=e,[a,l]=(0,r.useState)(!0),i=[{label:"Logical Writes",value:t.logicalWrites,tip:"Total 'put' or 'delete' operations initiated by the user."},{label:"Items Written to SSTables",value:t.itemsWrittenToSSTables,tip:"Total number of items (key-value pairs) physically written to SSTable objects (during flush or compaction)."},{label:"Write Amplification (WA)",value:t.writeAmplification,tip:"(Items Written to SSTables) / (Logical Writes). Ideal is 1. Higher values mean more I/O for writes."},{label:"Logical Reads",value:t.logicalReads,tip:"Total 'get' operations initiated by the user."},{label:"MemTable Lookups (Read)",value:t.memtableLookupsForRead,tip:"Number of times MemTable was checked during read operations."},{label:"SSTables Accessed (Read)",value:t.sstablesAccessedForRead,tip:"Total number of SSTables accessed (opened/checked) during read operations."},{label:"Read Amplification (SSTables)",value:t.readAmplificationSSTables,tip:"(SSTables Accessed) / (Logical Reads). Average SSTables checked per read. Ideal is low."}];return t?(0,s.jsxs)("div",{className:"p-4 bg-white shadow-md rounded-lg mb-6",children:[(0,s.jsxs)("button",{onClick:()=>l(!a),className:"w-full text-left text-xl font-semibold text-gray-700 mb-3 flex items-center",children:[a?(0,s.jsx)(g.A,{size:20,className:"mr-2"}):(0,s.jsx)(x.A,{size:20,className:"mr-2"}),(0,s.jsx)(F.A,{size:22,className:"mr-2 text-indigo-600"})," Performance Metrics"]}),a&&(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-gray-600",children:e.label}),(0,s.jsx)(f,{text:e.tip,children:(0,s.jsx)(b.A,{size:14,className:"text-gray-400 cursor-help"})})]}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-indigo-600 mt-1",children:e.value})]},e.label))})]}):null},A=()=>{let e=(0,r.useMemo)(()=>({memtableMaxSize:5,l0MaxSSTables:3,levelMaxSSTablesFactor:4,sstableMaxItems:10,maxLevels:5}),[]),[t,a]=(0,r.useState)(()=>new h(e)),[l,n]=(0,r.useState)(t.getState()),[c,m]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[g,x]=(0,r.useState)([]),b=(0,r.useCallback)(()=>{n(t.getState())},[t]);(0,r.useEffect)(()=>{b()},[t,b]);let f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;m(!0),await new Promise(e=>setTimeout(e,50)),t.compact(e),b(),m(!1),u(null),x([])},y=e=>{a(new h(e||t.config)),u(null),x([])},v=e=>{y(e)};return(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 min-h-screen bg-gray-100 p-4 md:p-8 font-sans",children:[(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 max-w-7xl mx-auto",children:[(0,s.jsxs)("header",{className:"jsx-3eba093054a1fc33 mb-8 text-center",children:[(0,s.jsx)("h1",{className:"jsx-3eba093054a1fc33 text-4xl font-bold text-gray-800",children:"LSM Tree Visualization"}),(0,s.jsx)("p",{className:"jsx-3eba093054a1fc33 text-lg text-gray-600",children:"Watch how a Log-Structured Merge Tree works interactively."})]}),(0,s.jsx)(p,{initialConfig:t.config,onSave:v,onResetDefault:()=>{v(e)}}),(0,s.jsx)(T,{onWrite:(e,a)=>{t.put(e,a),b(),u(null),x([])},onRead:e=>{let a=t.get(e);u(a),x(a.path||[]),b()},onDelete:e=>{t.delete(e),b(),u(null),x([])},onCompact:f,onResetTree:()=>y(t.config),isCompacting:c}),l.metrics&&(0,s.jsx)(C,{metrics:l.metrics}),d&&(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 my-4 p-4 bg-yellow-50 border border-yellow-300 rounded-lg shadow animate-fadeIn",children:[(0,s.jsx)("h3",{className:"jsx-3eba093054a1fc33 text-lg font-semibold text-yellow-800",children:"Read Result:"}),void 0===d.value&&(0,s.jsx)("p",{className:"jsx-3eba093054a1fc33 text-yellow-700",children:"Key not found."}),d.value===o&&(0,s.jsx)("p",{className:"jsx-3eba093054a1fc33 text-red-700",children:"Key found: Marked as DELETED (TOMBSTONE)."}),void 0!==d.value&&d.value!==o&&(0,s.jsxs)("p",{className:"jsx-3eba093054a1fc33 text-yellow-700",children:["Key found:"," ",(0,s.jsx)("span",{className:"jsx-3eba093054a1fc33 font-bold",children:JSON.stringify(d.value)})]})]}),(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 mt-6 grid grid-cols-1 xl:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 xl:col-span-2",children:[(0,s.jsx)("h2",{className:"jsx-3eba093054a1fc33 text-2xl font-semibold text-gray-700 mb-3",children:"LSM Tree Structure"}),(0,s.jsx)(M,{memtableData:l.memtable,maxSize:l.config.memtableMaxSize,readPathItem:null==g?void 0:g.find(e=>"memtable"===e.id)}),l.levels.map((e,t)=>(0,s.jsx)(k,{level:e,levelIdx:t,readPath:g},t))]}),(0,s.jsxs)("div",{className:"jsx-3eba093054a1fc33 xl:col-span-1",children:[(0,s.jsx)("h2",{className:"jsx-3eba093054a1fc33 text-2xl font-semibold text-gray-700 mb-3",children:"Operations Log"}),(0,s.jsx)(K,{logs:l.log})]})]}),(0,s.jsx)("footer",{className:"jsx-3eba093054a1fc33 mt-12 text-center text-sm text-gray-500 py-6 border-t border-gray-200",children:(0,s.jsx)("p",{className:"jsx-3eba093054a1fc33",children:"LSM Tree Visualization. Vibe coded with â¤ by human"})})]}),(0,s.jsx)(i(),{id:"3eba093054a1fc33",children:".animate-fadeIn{-webkit-animation:fadeIn.5s ease-in-out;-moz-animation:fadeIn.5s ease-in-out;-o-animation:fadeIn.5s ease-in-out;animation:fadeIn.5s ease-in-out}@-webkit-keyframes fadeIn{0%{opacity:0;-webkit-transform:translatey(-10px);transform:translatey(-10px)}100%{opacity:1;-webkit-transform:translatey(0);transform:translatey(0)}}@-moz-keyframes fadeIn{0%{opacity:0;-moz-transform:translatey(-10px);transform:translatey(-10px)}100%{opacity:1;-moz-transform:translatey(0);transform:translatey(0)}}@-o-keyframes fadeIn{0%{opacity:0;-o-transform:translatey(-10px);transform:translatey(-10px)}100%{opacity:1;-o-transform:translatey(0);transform:translatey(0)}}@keyframes fadeIn{0%{opacity:0;-webkit-transform:translatey(-10px);-moz-transform:translatey(-10px);-o-transform:translatey(-10px);transform:translatey(-10px)}100%{opacity:1;-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}}.animate-pulse{-webkit-animation:pulse 1.5s cubic-bezier(.4,0,.6,1)infinite;-moz-animation:pulse 1.5s cubic-bezier(.4,0,.6,1)infinite;-o-animation:pulse 1.5s cubic-bezier(.4,0,.6,1)infinite;animation:pulse 1.5s cubic-bezier(.4,0,.6,1)infinite}@-webkit-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@-moz-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@-o-keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}"})]})}},6633:(e,t,a)=>{Promise.resolve().then(a.bind(a,5049))}},e=>{var t=t=>e(e.s=t);e.O(0,[571,441,684,358],()=>t(6633)),_N_E=e.O()}]);